<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>üå∏ S·∫ÆC ƒê·∫∏P D√ÇN T·ªòC TH√ÅI üáπüá≠</title>
  
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;800;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
  
  <style>
    /* GI·ªÆ NGUY√äN TO√ÄN B·ªò STYLE C≈® C·ª¶A B·∫†N */
    :root {
      --primary-red: #8B0000;
      --secondary-gold: #FFD700;
      --text: #333333;
      --white: #ffffff;
      --cream: #fffaf0;
      --trans-white: rgba(255, 255, 255, 0.8);
      --trans-cream: rgba(255, 255, 255, 0.65);
    }

    body {
      font-family: 'Nunito', sans-serif;
      margin: 0; padding: 0;
      background-color: var(--cream);
      color: var(--text);
      overflow-x: hidden;
      transition: opacity 0.4s ease-in-out;
    }

    /* HI·ªÜU ·ª®NG CHUY·ªÇN TRANG C·ª¶A B·∫†N */
    .page-enter { opacity: 0; transform: translateY(15px); }
    .page-enter-active { opacity: 1; transform: translateY(0); transition: all 0.4s ease-out; }
    .page-exit-active { opacity: 0; transform: translateY(-15px); transition: all 0.3s ease-in; }

    header {
      padding: 50px 20px;
      background: linear-gradient(rgba(0,0,0,0.55), rgba(0,0,0,0.55)), 
                  url('https://i.pinimg.com/736x/8e/31/34/8e31346294747796d860e61d87c88b48.jpg');
      background-size: cover; background-position: center;
      color: var(--white); text-shadow: 2px 2px 8px rgba(0,0,0,0.5);
    }

    nav {
      background: var(--trans-white);
      backdrop-filter: blur(10px);
      padding: 12px;
      position: sticky; top: 14px; z-index: 1000;
      margin: 0 10px; border-radius: 22px;
      display: flex; justify-content: center; gap: 8px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.1);
    }

    nav a {
      text-decoration: none; color: var(--primary-red);
      font-weight: 900; padding: 10px 18px; border-radius: 18px;
      transition: 0.3s; font-size: 0.95rem;
    }

    nav a.active { background: var(--primary-red); color: white; }

    .card {
      background: var(--trans-cream);
      backdrop-filter: blur(8px);
      border-radius: 30px; padding: 26px; margin: 20px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.15);
      border: 1px solid rgba(255,255,255,0.4);
    }

    /* N√öT ZALO RUNG RINH G√ìC TR√ÅI */
    .zalo-float {
      position: fixed; bottom: 30px; left: 30px; z-index: 9999;
      width: 60px; height: 60px; background: #0088ff;
      border-radius: 50%; display: flex; align-items: center; justify-content: center;
      box-shadow: 0 4px 15px rgba(0,0,0,0.3); animation: pulse-zalo 2s infinite;
    }
    .zalo-float i { color: white; font-size: 32px; }
    @keyframes pulse-zalo {
      0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(0,136,255,0.7); }
      70% { transform: scale(1.1); box-shadow: 0 0 0 15px rgba(0,136,255,0); }
      100% { transform: scale(1); }
    }

    /* GRID S·∫¢N PH·∫®M */
    .product-grid {
      display: grid; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); gap: 20px;
    }

    .product-card {
      background: white; border-radius: 25px; padding: 15px;
      transition: 0.3s; border: 1px solid #eee; cursor: pointer;
    }
    .product-card:hover { transform: translateY(-8px); box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
    .product-card img { width: 100%; border-radius: 20px; aspect-ratio: 1; object-fit: cover; }

    /* MODAL & FORM THANH TO√ÅN */
    .modal-overlay {
      position: fixed; inset: 0; background: rgba(0,0,0,0.75);
      display: none; align-items: center; justify-content: center; z-index: 2000; padding: 15px;
    }
    .modal-content {
      background: white; border-radius: 30px; width: 100%; max-width: 480px;
      max-height: 90vh; overflow-y: auto; position: relative; padding: 25px;
    }

    .checkout-form input, .checkout-form textarea {
      width: 100%; padding: 14px; margin: 10px 0;
      border: 1.5px solid #eee; border-radius: 12px; font-family: inherit; box-sizing: border-box;
    }

    .qr-box {
      background: #fffcf0; padding: 20px; border-radius: 20px;
      border: 2px dashed var(--primary-red); margin: 20px 0; text-align: center;
    }
    .qr-box img { width: 200px; border-radius: 10px; }

    .btn-action {
      background: var(--primary-red); color: white; border: none;
      width: 100%; padding: 16px; border-radius: 15px;
      font-weight: 900; cursor: pointer; font-size: 1.1rem;
    }
    .btn-zalo { background: #0088ff; margin-top: 10px; }

    .hidden { display: none; }
  </style>
</head>
<body class="page-enter page-enter-active">

  <a id="zalo-float-link" href="#" target="_blank" class="zalo-float">
    <i class="fa-brands fa-zalo"><img src="https://upload.wikimedia.org/wikipedia/commons/9/91/Icon_of_Zalo.svg" width="35"></i>
  </a>

  <header>
    <h1 style="font-size: 2.5rem; margin-bottom: 5px;">S·∫ÆC ƒê·∫∏P D√ÇN T·ªòC TH√ÅI</h1>
    <div id="shop-announcement" style="background: rgba(255,255,255,0.2); padding: 10px; border-radius: 10px; display: inline-block; font-style: italic;">
      ƒêang t·∫£i th√¥ng b√°o m·ªõi nh·∫•t...
    </div>
  </header>

  <nav>
    <a href="#home" class="nav-link active">GI·ªöI THI·ªÜU</a>
    <a href="#products" class="nav-link">S·∫¢N PH·∫®M</a>
    <a href="#track" class="nav-link">THEO D√ïI ƒê∆†N</a>
  </nav>

  <div id="home" class="section">
    <section class="card">
      <h2 style="color: var(--primary-red);">T·ª∞ H√ÄO B·∫¢N S·∫ÆC TH√ÅI</h2>
      <p>Ch√†o m·ª´ng b·∫°n ƒë·∫øn v·ªõi n∆°i g√¨n gi·ªØ v√† lan t·ªèa nh·ªØng n√©t ƒë·∫πp tinh hoa t·ª´ trang ph·ª•c, ·∫©m th·ª±c ƒë·∫øn vƒÉn h√≥a ƒë·∫∑c tr∆∞ng c·ªßa ƒë·ªìng b√†o d√¢n t·ªôc Th√°i.</p>
    </section>
  </div>

  <div id="products" class="section hidden">
    <section class="card">
      <h2 style="color: var(--primary-red);">DANH S√ÅCH S·∫¢N PH·∫®M</h2>
      <div class="product-grid" id="product-container"></div>
    </section>
  </div>

  <div id="track" class="section hidden">
    <section class="card">
      <h2 style="color: var(--primary-red);">TRA C·ª®U ƒê∆†N H√ÄNG</h2>
      <div style="display: flex; gap: 10px; margin-bottom: 20px;">
        <input type="text" id="track-id" placeholder="Nh·∫≠p m√£ ƒë∆°n (V√≠ d·ª•: SDT1234)" style="flex:1; padding:15px; border-radius:15px; border:1px solid #ddd;">
        <button onclick="handleTrack()" style="background:var(--primary-red); color:white; border:none; padding:0 25px; border-radius:15px; font-weight:bold;">TRA C·ª®U</button>
      </div>
      <div id="track-result"></div>
    </section>
  </div>

  <div id="modal" class="modal-overlay">
    <div class="modal-content">
      <button onclick="closeModal()" style="position:absolute; right:20px; top:15px; border:none; background:none; font-size:30px; cursor:pointer;">&times;</button>
      
      <div id="m-step-1">
        <h2 id="m-title"></h2>
        <p id="m-price" style="font-size:1.5rem; color:var(--primary-red); font-weight:900;"></p>
        <button onclick="showCheckoutForm()" class="btn-action">MUA NGAY</button>
      </div>

      <div id="m-step-2" class="hidden">
        <h3>TH√îNG TIN NH·∫¨N H√ÄNG</h3>
        <div class="checkout-form">
          <input type="text" id="f-name" placeholder="H·ªç t√™n ng∆∞·ªùi nh·∫≠n">
          <input type="text" id="f-phone" placeholder="S·ªë ƒëi·ªán tho·∫°i">
          <input type="text" id="f-zalo" placeholder="S·ªë Zalo (ƒë·ªÉ nh·∫≠n m√£ v·∫≠n ƒë∆°n)">
          <textarea id="f-address" rows="2" placeholder="ƒê·ªãa ch·ªâ giao h√†ng"></textarea>
        </div>
        
        <div class="qr-box">
          <p>S·ªë ti·ªÅn c·ªçc 50%: <b id="deposit-amt" style="color:red; font-size:1.2rem;"></b>ƒë</p>
          <img id="qr-code" src="" alt="VietQR">
          <p style="font-size:12px; color:#666; margin-top:10px;">N·ªôi dung: <b id="qr-desc"></b></p>
        </div>
        
        <button id="btn-submit" onclick="processOrder()" class="btn-action">X√ÅC NH·∫¨N ƒê√É CHUY·ªÇN C·ªåC</button>
      </div>

      <div id="m-step-3" class="hidden" style="text-align: center;">
        <div style="font-size: 50px; color: #4CAF50;">‚úîÔ∏è</div>
        <h3>ƒê·∫∂T H√ÄNG TH√ÄNH C√îNG!</h3>
        <p>M√£ ƒë∆°n h√†ng c·ªßa b·∫°n:</p>
        <h2 id="final-order-id" style="color:red; letter-spacing: 2px;"></h2>
        <p style="font-size: 13px; color:#777;">Vui l√≤ng ch·ª•p ·∫£nh m√†n h√¨nh ho·∫∑c Sao ch√©p m√£ ƒë∆°n n√†y.</p>
        <button id="btn-send-zalo" class="btn-action btn-zalo">G·ª¨I M√É ƒê∆†N QUA ZALO SHOP</button>
      </div>
    </div>
  </div>

  <script>
    const CONFIG_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vR0FQlaE-0xia0mxdQJiX0QL1QDqqYSu1MketjyqBT1tQcNdUUlW50H0gyH5c7DLrcYuN3aSvOXVYpI/pub?output=tsv';
    const ORDER_SHEET = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vR_gk_A5DJadG6T99oSR5jQ-sN_XGI7UOVMuWK6aDvSTQUggUY10QzcWjYsW-RpiMuhSqsLr1x4pW_y/pub?output=tsv';
    
    // !!! QUAN TR·ªåNG: D√ÅN URL APPS SCRIPT C·ª¶A B·∫†N V√ÄO ƒê√ÇY !!!
    const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbze1k6huhD9s9dKSaFW_cuOISflxejjY8Ly_fdyQ1QWEhl0dKcCNMKDpkzi0wLC0WkY/exec';

    let shopData = {};
    let productList = [];
    let activeProduct = {};

    async function fetchData() {
      const res = await fetch(CONFIG_URL);
      const text = await res.text();
      const rows = Papa.parse(text, {header:true, delimiter:'\t'}).data;
      
      shopData = rows[0];
      productList = rows.slice(1);

      // C·∫≠p nh·∫≠t giao di·ªán t·ª´ Sheet
      document.getElementById('shop-announcement').innerText = shopData.shop_announcement;
      document.getElementById('zalo-float-link').href = `https://zalo.me/${shopData.zalo_phone.replace(/'/g, '')}`;
      
      const container = document.getElementById('product-container');
      container.innerHTML = productList.map(p => `
        <div class="product-card" onclick="openModal('${p.title}', '${p.price}')">
          <img src="${p.img}" alt="${p.title}">
          <h3 style="margin:10px 0 5px 0; font-size:1.1rem;">${p.title}</h3>
          <p style="color:var(--primary-red); font-weight:900; margin:0;">${p.price}ƒë</p>
        </div>
      `).join('');
    }

    function openModal(title, price) {
      activeProduct = { title, price };
      document.getElementById('m-title').innerText = title;
      document.getElementById('m-price').innerText = price + " VNƒê";
      document.getElementById('m-step-1').classList.remove('hidden');
      document.getElementById('m-step-2').classList.add('hidden');
      document.getElementById('m-step-3').classList.add('hidden');
      document.getElementById('modal').style.display = 'flex';
    }

    function showCheckoutForm() {
      document.getElementById('m-step-1').classList.add('hidden');
      document.getElementById('m-step-2').classList.remove('hidden');
      
      const oId = "SDT" + Math.floor(1000 + Math.random() * 8999);
      activeProduct.id = oId;

      const cleanPrice = parseInt(activeProduct.price.replace(/\D/g,''));
      const deposit = cleanPrice * 0.5;
      const cleanTitle = activeProduct.title.normalize("NFD").replace(/[\u0300-\u036f]/g, "").replace(/\s/g, "");
      const desc = `COC ${oId} ${cleanTitle}`.toUpperCase();

      document.getElementById('deposit-amt').innerText = deposit.toLocaleString();
      document.getElementById('qr-desc').innerText = desc;
      document.getElementById('qr-code').src = `https://img.vietqr.io/image/${shopData.bank_id}-${shopData.bank_account}-compact.png?amount=${deposit}&addInfo=${desc}&accountName=${shopData.bank_name}`;
    }

    async function processOrder() {
      const name = document.getElementById('f-name').value;
      const phone = document.getElementById('f-phone').value;
      if(!name || !phone) return alert("Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß T√™n v√† SƒêT!");

      const btn = document.getElementById('btn-submit');
      btn.innerText = "ƒêANG X·ª¨ L√ù...";
      btn.disabled = true;

      const payload = {
        order_id: activeProduct.id,
        customer_name: name,
        phone: phone,
        address: document.getElementById('f-address').value,
        product_name: activeProduct.title,
        note: "Zalo: " + document.getElementById('f-zalo').value
      };

      try {
        await fetch(APPS_SCRIPT_URL, { method: 'POST', mode: 'no-cors', body: JSON.stringify(payload) });
        
        document.getElementById('m-step-2').classList.add('hidden');
        document.getElementById('m-step-3').classList.remove('hidden');
        document.getElementById('final-order-id').innerText = activeProduct.id;

        const msg = encodeURIComponent(`Ch√†o Shop, t√¥i v·ª´a ƒë·∫∑t ƒë∆°n ${activeProduct.id} cho s·∫£n ph·∫©m ${activeProduct.title}. Vui l√≤ng x√°c nh·∫≠n ƒë∆°n!`);
        document.getElementById('btn-send-zalo').onclick = () => {
          window.open(`https://zalo.me/${shopData.zalo_phone.replace(/'/g, '')}?text=${msg}`, '_blank');
        };
      } catch (e) {
        alert("G·ª≠i ƒë∆°n th·∫•t b·∫°i, h√£y ch·ª•p m√†n h√¨nh QR v√† g·ª≠i cho shop qua Zalo!");
      }
    }

    async function handleTrack() {
      const id = document.getElementById('track-id').value.trim().toUpperCase();
      const res = await fetch(ORDER_SHEET);
      const text = await res.text();
      const orders = Papa.parse(text, {header:true, delimiter:'\t'}).data;
      
      const found = orders.find(o => o.order_id === id);
      const resDiv = document.getElementById('track-result');
      if(found) {
        resDiv.innerHTML = `
          <div style="background:#f0fff4; border-left:6px solid #38a169; padding:20px; border-radius:15px;">
            <p>üì¶ <b>S·∫£n ph·∫©m:</b> ${found.product_name}</p>
            <p>üë§ <b>Kh√°ch h√†ng:</b> ${found.customer_name}</p>
            <p>üö© <b>Tr·∫°ng th√°i:</b> <span style="color:red; font-weight:bold;">${found.status}</span></p>
            <p>üöö <b>Ti·∫øn ƒë·ªô:</b> ${found.progress}</p>
          </div>`;
      } else {
        resDiv.innerHTML = "<p style='color:red;'>‚ùå Kh√¥ng t√¨m th·∫•y m√£ ƒë∆°n h√†ng n√†y!</p>";
      }
    }

    function closeModal() { document.getElementById('modal').style.display = 'none'; }

    // X·ª¨ L√ù CHUY·ªÇN TAB C·ª¶A B·∫†N
    document.querySelectorAll('.nav-link').forEach(link => {
      link.onclick = (e) => {
        e.preventDefault();
        const target = link.getAttribute('href').substring(1);
        document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
        link.classList.add('active');
        
        document.querySelectorAll('.section').forEach(s => s.classList.add('hidden'));
        document.getElementById(target).classList.remove('hidden');
        window.scrollTo({top: 0, behavior: 'smooth'});
      }
    });

    fetchData();
  </script>
</body>
</html>
