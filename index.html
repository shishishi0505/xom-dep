<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ğŸŒ¸ Sáº®C Äáº¸P DÃ‚N Tá»˜C THÃI ğŸ‡¹ğŸ‡­</title>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;800;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
  
  <style>
    /* CSS Cá» Äá»ŠNH & GIAO DIá»†N Má»šI */
    :root { --primary-red: #8B0000; --secondary-gold: #FFD700; --cream: #fffaf0; }
    body { font-family: 'Nunito', sans-serif; margin: 0; background: var(--cream); text-align: center; }
    
    .zalo-float { position: fixed; bottom: 20px; left: 20px; z-index: 999; width: 60px; height: 60px; background: #0088ff; border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 15px rgba(0,0,0,0.3); animation: pulse 2s infinite; text-decoration: none; }
    .zalo-float i { color: white; font-size: 30px; }
    @keyframes pulse { 0% {transform: scale(1);} 50% {transform: scale(1.1);} 100% {transform: scale(1);} }

    header { padding: 40px 20px; background: linear-gradient(rgba(0,0,0,0.6), rgba(0,0,0,0.6)), url('https://i.pinimg.com/736x/8e/31/34/8e31346294747796d860e61d87c88b48.jpg'); background-size: cover; color: white; }
    nav { background: white; padding: 12px; position: sticky; top: 0; z-index: 100; display: flex; justify-content: center; gap: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
    nav a { text-decoration: none; color: var(--primary-red); font-weight: 800; padding: 8px 15px; border-radius: 20px; }
    nav a.active { background: var(--primary-red); color: white; }

    .card { background: white; border-radius: 20px; padding: 20px; margin: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
    .product-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px; padding: 10px; }
    .product-item { background: #fff; padding: 10px; border-radius: 15px; border: 1px solid #eee; cursor: pointer; }
    .product-item img { width: 100%; border-radius: 10px; }

    .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.8); display: none; align-items: center; justify-content: center; z-index: 1000; padding: 20px; }
    .modal-content { background: white; padding: 20px; border-radius: 20px; width: 100%; max-width: 450px; max-height: 90vh; overflow-y: auto; position: relative; }
    .checkout-form input { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #ddd; border-radius: 10px; box-sizing: border-box; }
    .btn-buy { background: var(--primary-red); color: white; border: none; padding: 15px; width: 100%; border-radius: 10px; font-weight: 800; cursor: pointer; margin-top: 10px; }
    .qr-box { background: #fef9f9; padding: 15px; border-radius: 15px; border: 2px dashed #8b0000; margin-top: 15px; }
    .qr-box img { width: 180px; }
    .hidden { display: none; }
    .success-msg { color: green; font-weight: bold; margin: 15px 0; }
  </style>
</head>
<body>

  <a id="zalo-link" href="#" target="_blank" class="zalo-float"><i class="fas fa-comment"></i></a>

  <header>
    <h1>Sáº®C Äáº¸P DÃ‚N Tá»˜C THÃI</h1>
    <p id="shop-note">Äang táº£i thÃ´ng bÃ¡o...</p>
  </header>

  <nav>
    <a href="#home" class="nav-link active">GIá»šI THIá»†U</a>
    <a href="#shop" class="nav-link">Sáº¢N PHáº¨M</a>
    <a href="#track" class="nav-link">TRA ÄÆ N</a>
  </nav>

  <section id="home" class="card">
    <h2>ChÃ o má»«ng quÃ½ khÃ¡ch!</h2>
    <p>NÆ¡i lÆ°u giá»¯ nÃ©t Ä‘áº¹p vÄƒn hÃ³a vÃ  Ä‘áº·c sáº£n TÃ¢y Báº¯c.</p>
  </section>

  <section id="shop" class="card hidden">
    <div class="product-grid" id="product-list"></div>
  </section>

  <section id="track" class="card hidden">
    <h2>TRA Cá»¨U ÄÆ N HÃ€NG</h2>
    <input type="text" id="input-track" placeholder="Nháº­p mÃ£ Ä‘Æ¡n (VÃ­ dá»¥: SDT1234)" style="padding:12px; border-radius:10px; border:1px solid #ddd; width: 80%;">
    <button onclick="trackOrder()" class="btn-buy" style="width: auto; padding: 12px 30px;">KIá»‚M TRA</button>
    <div id="track-result" style="margin-top:20px; text-align: left; line-height: 1.6;"></div>
  </section>

  <div id="modal" class="modal">
    <div class="modal-content">
      <button onclick="closeModal()" style="position:absolute; right:15px; top:10px; border:none; background:none; font-size:24px;">&times;</button>
      <h3 id="m-title"></h3>
      <p id="m-price" style="color:var(--primary-red); font-weight:800;"></p>
      
      <div id="step-1">
        <button onclick="showStep2()" class="btn-buy">MUA NGAY</button>
      </div>

      <div id="step-2" class="hidden">
        <div class="checkout-form">
          <input type="text" id="f-name" placeholder="Há» tÃªn ngÆ°á»i nháº­n">
          <input type="text" id="f-phone" placeholder="Sá»‘ Ä‘iá»‡n thoáº¡i nháº­n hÃ ng">
          <input type="text" id="f-zalo" placeholder="Sá»‘ Zalo há»— trá»£ (khÃ´ng báº¯t buá»™c)">
          <input type="text" id="f-address" placeholder="Äá»‹a chá»‰ chi tiáº¿t">
        </div>
        <div class="qr-box">
          <p style="font-size:14px; margin-bottom:5px;">QuÃ©t mÃ£ cá»c 50%: <b id="deposit-text"></b>Ä‘</p>
          <img id="qr-img" src="" alt="QR Chuyá»ƒn khoáº£n">
          <p style="font-size:11px; color:#666;">Ná»™i dung: <b id="qr-info"></b></p>
        </div>
        <button id="btn-finish" onclick="submitOrder()" class="btn-buy">XÃC NHáº¬N ÄÃƒ CHUYá»‚N Cá»ŒC</button>
      </div>

      <div id="step-3" class="hidden">
        <div class="success-msg">ğŸ‰ Äáº¶T HÃ€NG THÃ€NH CÃ”NG!</div>
        <p>MÃ£ Ä‘Æ¡n hÃ ng cá»§a báº¡n lÃ : <b id="final-id" style="color:red; font-size:20px;"></b></p>
        <p style="font-size:13px; color:#555;">(Báº¡n hÃ£y CHá»¤P MÃ€N HÃŒNH hoáº·c SAO CHÃ‰P mÃ£ nÃ y Ä‘á»ƒ theo dÃµi Ä‘Æ¡n hÃ ng nhÃ©)</p>
        <button id="btn-zalo-confirm" class="btn-buy" style="background:#0088ff;">Gá»¬I MÃƒ ÄÆ N QUA ZALO SHOP</button>
      </div>
    </div>
  </div>

  <script>
    const CONFIG_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vR0FQlaE-0xia0mxdQJiX0QL1QDqqYSu1MketjyqBT1tQcNdUUlW50H0gyH5c7DLrcYuN3aSvOXVYpI/pub?output=tsv';
    const ORDER_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vR_gk_A5DJadG6T99oSR5jQ-sN_XGI7UOVMuWK6aDvSTQUggUY10QzcWjYsW-RpiMuhSqsLr1x4pW_y/pub?output=tsv';
    
    // DÃN LINK APPS SCRIPT Cá»¦A Báº N VÃ€O ÄÃ‚Y
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbze1k6huhD9s9dKSaFW_cuOISflxejjY8Ly_fdyQ1QWEhl0dKcCNMKDpkzi0wLC0WkY/exec';

    let shopConfig = {};
    let products = [];
    let selectedProduct = {};

    async function init() {
      const res = await fetch(CONFIG_URL);
      const data = await res.text();
      const rows = Papa.parse(data, {header:true, delimiter:'\t'}).data;
      shopConfig = rows[0];
      products = rows.slice(1);

      document.getElementById('shop-note').innerText = shopConfig.shop_announcement;
      document.getElementById('zalo-link').href = `https://zalo.me/${shopConfig.zalo_phone.replace(/'/g, '')}`;
      
      const list = document.getElementById('product-list');
      list.innerHTML = products.map(p => `
        <div class="product-item" onclick="openModal('${p.title}', '${p.price}')">
          <img src="${p.img}">
          <h4>${p.title}</h4>
          <p style="color:red; font-weight:bold;">${p.price}Ä‘</p>
        </div>
      `).join('');
    }

    function openModal(title, price) {
      selectedProduct = { title, price };
      document.getElementById('m-title').innerText = title;
      document.getElementById('m-price').innerText = "GiÃ¡: " + price + " VNÄ";
      document.getElementById('step-1').classList.remove('hidden');
      document.getElementById('step-2').classList.add('hidden');
      document.getElementById('step-3').classList.add('hidden');
      document.getElementById('modal').style.display = 'flex';
    }

    function showStep2() {
      document.getElementById('step-1').classList.add('hidden');
      document.getElementById('step-2').classList.remove('hidden');
      
      const orderId = "SDT" + Math.floor(1000 + Math.random() * 9000);
      selectedProduct.id = orderId;

      const priceNum = parseInt(selectedProduct.price.replace(/\D/g,''));
      const deposit = priceNum * 0.5;
      const cleanTitle = selectedProduct.title.normalize("NFD").replace(/[\u0300-\u036f]/g, "").replace(/\s/g, "");
      const info = `COC ${orderId} ${cleanTitle}`.toUpperCase();

      document.getElementById('deposit-text').innerText = deposit.toLocaleString();
      document.getElementById('qr-info').innerText = info;
      document.getElementById('qr-img').src = `https://img.vietqr.io/image/${shopConfig.bank_id}-${shopConfig.bank_account}-compact.png?amount=${deposit}&addInfo=${info}&accountName=${shopConfig.bank_name}`;
    }

    async function submitOrder() {
      const name = document.getElementById('f-name').value;
      const phone = document.getElementById('f-phone').value;
      if(!name || !phone) return alert("Vui lÃ²ng nháº­p TÃªn vÃ  Sá»‘ Ä‘iá»‡n thoáº¡i!");

      document.getElementById('btn-finish').innerText = "ÄANG Gá»¬I...";
      document.getElementById('btn-finish').disabled = true;

      const orderData = {
        order_id: selectedProduct.id,
        customer_name: name,
        phone: phone,
        address: document.getElementById('f-address').value,
        product_name: selectedProduct.title,
        note: "Zalo: " + document.getElementById('f-zalo').value
      };

      try {
        await fetch(SCRIPT_URL, { method: 'POST', mode: 'no-cors', body: JSON.stringify(orderData) });
        
        document.getElementById('step-2').classList.add('hidden');
        document.getElementById('step-3').classList.remove('hidden');
        document.getElementById('final-id').innerText = selectedProduct.id;

        // Cáº¥u hÃ¬nh nÃºt gá»­i Zalo cho shop
        const zaloMsg = encodeURIComponent(`ChÃ o Shop, tÃ´i vá»«a Ä‘áº·t Ä‘Æ¡n ${selectedProduct.id} cho sáº£n pháº©m ${selectedProduct.title}. Vui lÃ²ng xÃ¡c nháº­n Ä‘Æ¡n cho tÃ´i!`);
        document.getElementById('btn-zalo-confirm').onclick = () => {
          window.open(`https://zalo.me/${shopConfig.zalo_phone.replace(/'/g, '')}?text=${zaloMsg}`, '_blank');
        };

      } catch (e) {
        alert("CÃ³ lá»—i khi gá»­i Ä‘Æ¡n. Báº¡n hÃ£y liÃªn há»‡ Zalo shop Ä‘á»ƒ Ä‘áº·t trá»±c tiáº¿p nhÃ©!");
      }
    }

    async function trackOrder() {
      const id = document.getElementById('input-track').value.trim().toUpperCase();
      const res = await fetch(ORDER_URL);
      const data = await res.text();
      const orders = Papa.parse(data, {header:true, delimiter:'\t'}).data;
      
      const order = orders.find(o => o.order_id === id);
      const resultDiv = document.getElementById('track-result');
      if(order) {
        resultDiv.innerHTML = `
          <div style="background:#e6fffa; padding:15px; border-radius:10px; border-left:5px solid green;">
            <p>âœ… <b>MÃ£ Ä‘Æ¡n:</b> ${order.order_id}</p>
            <p>ğŸ‘¤ <b>KhÃ¡ch hÃ ng:</b> ${order.customer_name}</p>
            <p>ğŸ“¦ <b>Sáº£n pháº©m:</b> ${order.product_name}</p>
            <p>ğŸ“ <b>Tráº¡ng thÃ¡i:</b> <span style="color:red; font-weight:bold;">${order.status}</span></p>
            <p>ğŸšš <b>Tiáº¿n Ä‘á»™:</b> ${order.progress}</p>
          </div>`;
      } else {
        resultDiv.innerHTML = "âŒ KhÃ´ng tÃ¬m tháº¥y mÃ£ Ä‘Æ¡n nÃ y. Vui lÃ²ng kiá»ƒm tra láº¡i!";
      }
    }

    function closeModal() { document.getElementById('modal').style.display = 'none'; }

    // Chuyá»ƒn tab
    document.querySelectorAll('.nav-link').forEach(link => {
      link.onclick = (e) => {
        e.preventDefault();
        document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
        link.classList.add('active');
        document.querySelectorAll('section').forEach(s => s.classList.add('hidden'));
        document.querySelector(link.getAttribute('href')).classList.remove('hidden');
      }
    });

    init();
  </script>
</body>
</html>
